{% extends 'base.html' %}{% load crispy_forms_tags %} {% block content %}
<h1>{{ beer.name }}</h1>
<h2>{{ beer.brewery }}</h2>
<p>Brewed in {{ beer.country_of_origin}}</p>
<p>{{ beer.strength }}% ABV</p>
{% if beer.average_rating %}
<p>Average rating: {{beer.average_rating}}</p>
{%endif%} 


{% if beer.image %}
<div>
  <img style="height:200px;" src="{{ beer.image.url }}"></img>
</div>
{% endif %}

{% with total_likes=beer.users_like.count users_like=beer.users_like.all %}
    <div class="image-info">
      <div>
        <span class="count">
         <span class="total">{{ total_likes }}</span>
         like{{ total_likes|pluralize }}
        </span>
        <a href="#" data-id="{{ beer.id }}" data-action="{% if request.user in users_like %}un{% endif %}like" class="like button">
          {% if request.user not in users_like %}
            Like
          {% else %}
            Unlike
          {% endif %}
        </a>
      </div>
      
    </div>
    
  {% endwith %}

{% if user.is_authenticated %}
<a class='btn btn-success'>Add/edit beer details</a> 

<!-- Button trigger modal -->
<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#addReview">
  Add Review
</button>

<!-- Modal -->
<div class="modal fade" id="addReview" tabindex="-1" role="dialog" aria-labelledby="addReview" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="addReviewLabel">Add Review</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form action="" method="post" enctype="multipart/form-data">
          {% csrf_token %} {{ form|crispy }}

          
        




      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="submit" class="btn btn-primary">Submit</button>
      </div>
      </form>
    </div>
  </div>
</div>

{% endif %} 

{% for review in reviews %}
<div>
  {{review.notes}}
</div>
{% endfor%} {% endblock %}
{% block domready %}
  $('a.like').click(function(e){
    e.preventDefault();
    $.post('{% url "like" %}',
      {
        id: $(this).data('id'),
        action: $(this).data('action')
      },
      function(data){
        if (data['status'] == 'ok')
        {
          var previous_action = $('a.like').data('action');

          // toggle data-action
          $('a.like').data('action', previous_action == 'like' ? 'unlike' : 'like');
          // toggle link text
          $('a.like').text(previous_action == 'like' ? 'Unlike' : 'Like');

          // update total likes
          var previous_likes = parseInt($('span.count .total').text());
          $('span.count .total').text(previous_action == 'like' ? previous_likes + 1 : previous_likes - 1);
        }
      }
    );
  });
{% endblock %}